<!DOCTYPE html>
<html>
<head>
  <title>数学函数绘图</title>
  <style>
    /* CSS样式 */
    body {
      font-family: Arial, sans-serif;
    }

    #canvas {
      width: 600px;
      height: 400px;
      margin-top: 20px;
      border: 1px solid #ccc;
    }

    #expression {
      width: 300px;
      padding: 5px;
      font-size: 14px;
    }

    #draw-button {
      padding: 5px 10px;
      font-size: 16px;
      margin-top: 10px;
    }

    #error-message {
      color: red;
      margin-top: 10px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/math-interpolate/dist/math-interpolate.min.js"></script>
</head>
<body>
  <h1>数学函数绘图</h1>
  <div>
    <label for="expression">函数表达式:</label>
    <input type="text" id="expression" placeholder="例如：sin(x)" />
    <button id="draw-button" onclick="drawGraph()">绘制图像</button>
    <p id="error-message"></p>
  </div>
  <div id="canvas"></div>

  <script>
    function drawGraph() {
      var canvas = document.getElementById("canvas");
      var expression = document.getElementById("expression").value;
      var errorMessage = document.getElementById("error-message");

      try {
        const expr = math.compile(expression);

        // 清空画布
        canvas.innerHTML = '';

        // 设置画布大小
        canvas.style.width = "600px";
        canvas.style.height = "400px";

        const minX = -10;
        const maxX = 10;
        const interval = 0.1;

        // 绘制坐标轴和原点
        drawAxis(canvas, minX, maxX);

        // 绘制函数图像（使用插值算法）
        const xValues = math.range(minX, maxX, interval).toArray();
        const yValues = xValues.map(function (x) {
          return expr.evaluate({ x: x });
        });

        const interpolatedX = math.range(minX, maxX, 0.01).toArray();
        const interpolatedY = mathInterpolate.interpCubic(xValues, yValues, interpolatedX);

        drawFunction(canvas, minX, maxX, interpolatedX, interpolatedY);

        // 清除错误消息
        errorMessage.textContent = "";
      } catch (error) {
        console.log(error);
        // 显示错误消息
        errorMessage.textContent = "无法绘制图像，请输入有效的函数表达式。";
      }
    }

    function drawAxis(canvas, minX, maxX) {
      var ctx = canvas.getContext("2d");
      var width = canvas.width;
      var height = canvas.height;

      var xAxisPos = height / 2;
      var yAxisPos = width / 2;

      ctx.beginPath();
      ctx.moveTo(0, xAxisPos);
      ctx.lineTo(width, xAxisPos);
      ctx.moveTo(yAxisPos, 0);
      ctx.lineTo(yAxisPos, height);
      ctx.strokeStyle = "#aaa";
      ctx.stroke();

      var numXMarkings = width / 50;
      var xInterval = (maxX - minX) / numXMarkings;

      for (var i = 1; i < numXMarkings; i++) {
        var xPos = i * width / numXMarkings;
        var xValue = minX + i * xInterval;

        ctx.beginPath();
        ctx.moveTo(xPos, xAxisPos - 5);
        ctx.lineTo(xPos, xAxisPos + 5);
        ctx.strokeStyle = "#aaa";
        ctx.stroke();

        ctx.fillStyle = "#000";
        ctx.fillText(xValue.toFixed(1), xPos - 10, xAxisPos + 20);
      }
    }

    function drawFunction(canvas, minX, maxX, xValues, yValues) {
      var ctx = canvas.getContext("2d");
      var width = canvas.width;
      var height = canvas.height;

      var xRange = maxX - minX;
      var yRange = Math.max(...yValues) - Math.min(...yValues);

      var xScale = width / xRange;
      var yScale = height / yRange;

      ctx.beginPath();
      ctx.moveTo((xValues[0] - minX) * xScale, height - ((yValues[0] - Math.min(...yValues)) * yScale));

      for (var i = 1; i < xValues.length; i++) {
        var x = (xValues[i] - minX) * xScale;
        var y = height - ((yValues[i] - Math.min(...yValues)) * yScale);
        ctx.lineTo(x, y);
      }

      ctx.lineWidth = 2;
      ctx.strokeStyle = "#f00";
      ctx.stroke();
    }
  </script>
</body>
</html>
